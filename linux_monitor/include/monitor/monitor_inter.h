// 头文件保护宏，防止重复包含
#pragma once

#include <string>

// 项目自定义头文件
#include "monitor_info.grpc.pb.h"     // gRPC生成的Protobuf消息定义

namespace monitor
{
    /**
     * @brief 监控器抽象接口类
     *
     * 定义所有具体监控器的通用接口，是监控系统框架的核心抽象基类。
     * 采用策略模式设计，允许通过继承此接口实现各种系统资源的监控，
     * 如CPU、内存、磁盘、网络等，实现监控功能的模块化和可扩展性。
     *
     * 设计模式：模板方法模式 + 策略模式
     * 职责：定义监控器的统一操作接口
     * 设计原则：依赖倒置原则（DIP）、开闭原则（OCP）
     */
    class MonitorInter
    {
    public:
        /**
         * @brief 默认构造函数
         *
         * 提供基类的默认构造，确保派生类可以正确初始化。
         */
        MonitorInter() {}

        /**
         * @brief 虚析构函数
         *
         * 声明为虚函数以确保通过基类指针删除派生类对象时，
         * 能够正确调用派生类的析构函数，避免内存泄漏。
         *
         * 遵循C++最佳实践：具有虚函数的类应该有虚析构函数。
         */
        virtual ~MonitorInter() {}

        /**
         * @brief 更新监控信息（纯虚函数）
         * @param monitor_info 输出参数，指向要填充的监控信息Protobuf消息
         *
         * 核心接口方法，每个具体监控器必须实现此方法以：
         * 1. 采集特定系统资源的状态数据
         * 2. 处理和分析采集到的数据
         * 3. 将结果填充到统一的Protobuf消息结构中
         *
         * 方法特点：
         * - 纯虚函数：强制派生类必须实现
         * - 非阻塞设计：应快速完成数据采集，避免长时间阻塞
         * - 幂等性：多次调用应产生相同的结果（如果系统状态不变）
         * - 异常安全：应妥善处理异常，避免影响其他监控器
         *
         * 实现要求：
         * - 线程安全性：如果监控系统在多线程环境中使用
         * - 性能效率：避免昂贵的操作，保持低开销
         * - 数据准确性：确保采集的数据正确反映系统状态
         */
        virtual void UpdateOnce(monitor::proto::MonitorInfo* monitor_info) = 0;

        /**
         * @brief 停止监控（纯虚函数）
         *
         * 用于执行监控器停止时的清理工作，如：
         * 1. 释放占用的资源（文件描述符、网络连接等）
         * 2. 保存状态信息
         * 3. 终止后台监控线程（如果有）
         *
         * 方法特点：
         * - 纯虚函数：强制派生类必须实现
         * - 幂等性：多次调用应无副作用
         * - 可重入性：应支持在运行过程中被调用
         *
         * 注意：对于简单的监控器（如只读取/proc文件），
         * 此方法可能实现为空，因为无需特殊清理。
         */
        virtual void Stop() = 0;
    };
}  // namespace monitor
